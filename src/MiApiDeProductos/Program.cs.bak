var builder = WebApplication.CreateBuilder(args);

// Agrega servicios al contenedor.
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

var app = builder.Build();

// Configura el pipeline de peticiones HTTP.
if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI();
}


// ----------------------------------------------------

// --- Endpoints de la API para el Curso ---

app.MapGet("/api/products", () =>
{
    return Results.Ok(ProductRepository.Products);
})
.WithName("GetAllProducts")
.WithDescription("Obtiene la lista completa de productos.")
.WithOpenApi();

app.MapGet("/api/products/{id}", (int id) => {
    var product = ProductRepository.Products.FirstOrDefault(p => p.Id == id);
    return product is not null ? Results.Ok(product) : Results.NotFound();
}).WithName("GetProductById").WithOpenApi();

// Aquí añadiremos más endpoints durante el curso...
app.MapGet("/api/inventory/product/{id}/movements", (int id) => {
    var movements = InventoryRepository.Movements.Where(m => m.ProductId == id);
    return Results.Ok(movements);
}).WithName("GetInventoryMovements").WithOpenApi();

// ---------------------------

app.Run();

// --- Definición del Modelo y Datos para el Curso ---
public record Product(int Id, string Name, double Price, int Stock);

public static class ProductRepository
{
    public static List<Product> Products { get; } = new List<Product>
    {
        new(1, "Laptop Gamer Pro", 2100.50, 15),
        new(2, "Teclado Mecánico RGB", 120.00, 50),
        new(3, "Monitor Curvo 34\"", 899.99, 10),
        new(4, "Webcam 4K con Aro de Luz", 150.75, 30)
    };
}

public record InventoryMovement(int ProductId, DateTime Timestamp, string Type, int Quantity);
public static class InventoryRepository
{
    public static List<InventoryMovement> Movements { get; } = new List<InventoryMovement>
    { new(1, DateTime.UtcNow.AddDays(-10), "Restock", 5), new(1, DateTime.UtcNow.AddDays(-8), "Sale", -1), new(1, DateTime.UtcNow.AddDays(-5), "Sale", -1), new(2, DateTime.UtcNow.AddDays(-15), "Restock", 20), new(2, DateTime.UtcNow.AddDays(-12), "Sale", -5), new(3, DateTime.UtcNow.AddDays(-20), "Restock", 10) };
}